 
# Create your models here.
from django.db import models
from usuarios.models import Usuario
class Mascota(models.Model):
    SEXO_CHOICES = [
        ('M', 'Macho'),
        ('H', 'Hembra'),
    ]

    idMascota = models.AutoField(primary_key=True)
    nombre = models.CharField(max_length=100)
    nacimiento = models.DateField()
    especie = models.CharField(max_length=50)
    sexo = models.CharField(max_length=1, choices=SEXO_CHOICES)
    peso = models.DecimalField(max_digits=5, decimal_places=2)
    altura = models.DecimalField(max_digits=5, decimal_places=2)
    ancho = models.DecimalField(max_digits=5, decimal_places=2)
    raza = models.CharField(max_length=100)
    usuario = models.ForeignKey(Usuario, on_delete=models.CASCADE, related_name='mascotas')

    def __str__(self):
        return self.nombre
    
    
class Cita(models.Model):
    id = models.AutoField(primary_key=True)
    fecha = models.DateTimeField()
    veterinaria = models.CharField(max_length=255)
    doctor = models.CharField(max_length=255)
    problema = models.CharField(max_length=255)
    descripcion = models.TextField()
    id_mascota = models.ForeignKey(Mascota, on_delete=models.CASCADE)

    def __str__(self):
        return f"Cita #{self.id} - {self.doctor} - {self.fecha.strftime('%Y-%m-%d %H:%M')} - {self.id_mascota.nombre}"
 
class Tratamiento(models.Model):
    id = models.AutoField(primary_key=True)
    medicamento = models.CharField(max_length=255)
    aplicacion = models.TextField()
    fecha_inicio = models.DateField()
    fecha_finalizacion = models.DateField()
    id_cita = models.ForeignKey(Cita, on_delete=models.CASCADE, related_name='tratamientos')

    def __str__(self):
        return f"Tratamiento para {self.id_cita.id_mascota.nombre} - Medicamento: {self.medicamento}"
    
     
class Vacuna(models.Model):
    id = models.AutoField(primary_key=True)
    fecha = models.DateTimeField()
    veterinaria = models.CharField(max_length=255)
    doctor = models.CharField(max_length=255)
    medicamento = models.CharField(max_length=255)
    mascota = models.ForeignKey(Mascota, on_delete=models.CASCADE, related_name='vacunas')

    def __str__(self):
        return f'Vacuna de {self.medicamento} para {self.mascota.nombre} el {self.fecha.strftime("%d-%m-%Y")}'

    class Meta:
        verbose_name = "Vacuna"
        verbose_name_plural = "Vacunas"

  ## usuario 

from django.db import models
from django.utils import timezone

# Create your models here.

class Usuario(models.Model):
    nombre = models.CharField(max_length=255)
    apellido = models.CharField(max_length=255)
    imagen = models.ImageField(upload_to='imagenes_usuarios/', blank=True, null=True)
    correo_electronico = models.EmailField(unique=True)
    contrasena = models.CharField(max_length=255)
    numero_telefono = models.CharField(max_length=20, blank=True, null=True)
    direccion = models.CharField(max_length=255, blank=True, null=True)
    ciudad = models.CharField(max_length=100, blank=True, null=True)
    pais = models.CharField(max_length=100, blank=True, null=True)
    fecha_nacimiento = models.DateField(blank=True, null=True)
    genero = models.CharField(max_length=50, blank=True, null=True)
    fecha_registro = models.DateTimeField(default=timezone.now)

    def __str__(self):
        return f'{self.nombre} {self.apellido}'

    class Meta:
        verbose_name = "Usuario"
        verbose_name_plural = "Usuarios"


class EstadoUsuario(models.Model):
    usuario = models.OneToOneField(Usuario, on_delete=models.CASCADE, related_name='estado_usuario')
    activo = models.BooleanField(default=True)
    fecha_ultima_actividad = models.DateTimeField(default=timezone.now)
    fecha_inactividad = models.DateTimeField(blank=True, null=True)

    def __str__(self):
        estado = 'Activo' if self.activo else 'Inactivo'
        return f'{self.usuario.nombre} {self.usuario.apellido} - {estado}'

    class Meta:
        verbose_name = "Estado de Usuario"
        verbose_name_plural = "Estados de Usuario"
        
